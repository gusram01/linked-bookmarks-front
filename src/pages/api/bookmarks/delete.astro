---
const auth = Astro.locals.auth();

if (!auth.userId) {
  throw new Error('Unauthorized');
}

if (Astro.request.method === 'POST') {
  try {
    const formData = await Astro.request.formData();
    const id = formData.get('id');

    const response = await fetch(`http://localhost:8080/api/bookmarks/${id}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${auth.userId}`,
        'Content-Type': 'application/json'
      }
    });

    if (response.ok) {
      Astro.redirect('/dashboard?success=Bookmark deleted successfully');
    } else {
      Astro.redirect('/dashboard?error=Failed to delete bookmark');
    }
  } catch (e) {
    Astro.redirect('/dashboard?error=Unable to connect to API server');
  }
} else {
  throw new Error('Method not allowed');
}
---
